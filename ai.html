<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campus Connect AI</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React and Babel for running React in the browser -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Custom Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            overflow: hidden; /* Prevent scrolling body when app is fixed */
        }
        #background-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        /* Simple scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1f2937; /* dark:bg-gray-800 */
        }
        ::-webkit-scrollbar-thumb {
            background: #4b5563; /* dark:bg-gray-600 */
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6b7280; /* dark:bg-gray-500 */
        }
        .prose-white {
            color: #e2e8f0;
        }
        .prose-white h1, .prose-white h2, .prose-white h3, .prose-white h4, .prose-white strong {
            color: #ffffff;
        }
        .map-poi {
            cursor: pointer;
            transition: all 0.2s ease-in-out;
        }
        .map-poi:hover {
            opacity: 0.8;
            transform: scale(1.1);
        }
        .animate-fade-in-down {
            animation: fadeInDown 0.3s ease-out forwards;
        }
        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .chat-widget-enter {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
        }
        .chat-widget-enter-active {
            opacity: 1;
            transform: translateY(0) scale(1);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
        .chat-widget-exit {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
        .chat-widget-exit-active {
            opacity: 0;
            transform: translateY(20px) scale(0.95);
            transition: all 300ms cubic-bezier(0.4, 0, 0.2, 1);
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 text-gray-900 dark:text-gray-100">
    <canvas id="background-canvas"></canvas>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- GEMINI API HELPER ---
        const callGemini = async (prompt) => {
            const apiKey = ""; // Left empty as per instructions
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ parts: [{ text: prompt }] }] };
            let retries = 3, delay = 1000;
            while (retries > 0) {
                try {
                    const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(payload) });
                    if (response.ok) {
                        const result = await response.json();
                        return result.candidates?.[0]?.content?.parts?.[0]?.text || "No content generated.";
                    } else if (response.status === 429) {
                        console.warn("Rate limited. Retrying...");
                        await new Promise(resolve => setTimeout(resolve, delay));
                        delay *= 2;
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error?.message || `API Error: ${response.status}`);
                    }
                } catch (error) {
                    console.error("Fetch error:", error);
                    if (retries <= 1) throw error;
                    await new Promise(resolve => setTimeout(resolve, delay));
                    delay *= 2;
                }
                retries--;
            }
            throw new Error("Failed to get a response from the API after multiple retries.");
        };


        // --- UI COMPONENTS ---
        const Modal = ({ show, onClose, title, children }) => {
            if (!show) return null;
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex justify-center items-center z-50" onClick={onClose}>
                    <div className="bg-white dark:bg-gray-800 rounded-lg shadow-2xl p-6 w-11/12 max-w-lg relative" onClick={e => e.stopPropagation()}>
                        <h3 className="text-lg font-bold mb-4">{title}</h3>
                        <div className="text-sm text-gray-700 dark:text-gray-300 whitespace-pre-wrap prose prose-white max-w-none">{children}</div>
                        <button onClick={onClose} className="absolute top-4 right-4 text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">
                            <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </div>
                </div>
            );
        };
        
        const LoadingSpinner = () => (
             <svg className="animate-spin h-5 w-5 mr-3" viewBox="0 0 24 24">
                <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
        );

        // --- Main App Controller ---
        const App = () => {
            const [isLoggedIn, setIsLoggedIn] = useState(false);
            const [selectedBranch, setSelectedBranch] = useState(null);

            const handleLogin = () => setIsLoggedIn(true);
            const handleLogout = () => {
                setIsLoggedIn(false);
                setSelectedBranch(null);
            };
            const handleBranchSelect = (branch) => setSelectedBranch(branch);

            return (
                <React.Fragment>
                    <BackgroundAnimation />
                    { !isLoggedIn ? (
                        <LoginView onLogin={handleLogin} />
                    ) : !selectedBranch ? (
                        <BranchSelectorView onBranchSelect={handleBranchSelect} />
                    ) : (
                        <MainAppView selectedBranch={selectedBranch} onLogout={handleLogout} />
                    )}
                </React.Fragment>
            );
        };

        // --- LOGIN VIEW ---
        const LoginView = ({ onLogin }) => {
            return (
                <div className="min-h-screen w-full flex items-center justify-center">
                    <div className="w-full max-w-md p-8 space-y-8 bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl border border-white/20">
                        <div className="text-center">
                            <h1 className="text-3xl font-extrabold text-white">ðŸŽ“ Campus Connect AI</h1>
                            <p className="mt-2 text-indigo-200">Enter your credentials to access the portal.</p>
                        </div>
                        <form className="space-y-6" onSubmit={(e) => { e.preventDefault(); onLogin(); }}>
                            <div>
                                <label className="text-sm font-bold text-indigo-100 block mb-2">Student ID</label>
                                <input type="text" placeholder="e.g., 21X01A0501" className="w-full p-3 bg-white/20 text-white rounded-lg placeholder-indigo-200 focus:outline-none focus:ring-2 focus:ring-white/50" />
                            </div>
                            <div>
                                <label className="text-sm font-bold text-indigo-100 block mb-2">Password</label>
                                <input type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" className="w-full p-3 bg-white/20 text-white rounded-lg placeholder-indigo-200 focus:outline-none focus:ring-2 focus:ring-white/50" />
                            </div>
                             <button type="submit" className="w-full py-3 px-4 bg-white text-indigo-600 font-bold rounded-lg hover:bg-indigo-100 transition-all duration-300 shadow-lg">
                                Login
                            </button>
                        </form>
                    </div>
                </div>
            );
        };
        
        // --- BRANCH SELECTOR VIEW ---
        const BranchSelectorView = ({ onBranchSelect }) => {
            const branches = ["CSE", "ECE", "MECH", "CIVIL", "IT", "EEE"];
            return (
                 <div className="min-h-screen w-full flex flex-col items-center justify-center p-4">
                     <div className="text-center mb-8">
                        <h1 className="text-4xl font-extrabold text-white">Select Your Branch</h1>
                        <p className="mt-2 text-teal-100">Personalize your campus experience.</p>
                    </div>
                    <div className="grid grid-cols-2 md:grid-cols-3 gap-6 w-full max-w-2xl">
                        {branches.map(branch => (
                            <div key={branch} onClick={() => onBranchSelect(branch)} className="p-8 bg-white/10 backdrop-blur-lg rounded-2xl text-center text-white font-bold text-2xl cursor-pointer hover:bg-white/20 border border-white/20 transition-all duration-300 transform hover:scale-105">
                                {branch}
                            </div>
                        ))}
                    </div>
                 </div>
            );
        };


        // --- Main App Component ---
        const MainAppView = ({ selectedBranch, onLogout }) => {
            const [view, setView] = useState('home');
            const [isChatOpen, setIsChatOpen] = useState(false);

            const icons = {
                home: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
                schedule: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                dining: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l-3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l-3 9m-3-9l-6-2m0-2a2 2 0 012 2v10a2 2 0 01-2 2h-1a2 2 0 01-2-2V8a2 2 0 012-2h1z" /></svg>,
                map: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l5.447 2.724A1 1 0 0021 16.382V5.618a1 1 0 00-1.447-.894L15 7m-6 13v-6m6 6v-6m0 0l-6-3m6 3L9 7" /></svg>,
                events: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                faculty: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
                complaints: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
                profile: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
                info: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
                admin: <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
            };

            const NavButton = ({ targetView, currentView, setView, children, icon }) => {
                const isActive = currentView === targetView;
                return (
                    <button onClick={() => setView(targetView)} className={`w-full flex items-center space-x-3 px-4 py-2.5 text-sm font-medium rounded-lg transition-colors duration-200 ${isActive ? 'bg-gray-700 text-white' : 'text-gray-300 hover:bg-gray-700 hover:text-white'}`}>
                        {icon}
                        <span>{children}</span>
                    </button>
                );
            };

            return (
                <div className="h-screen w-screen flex bg-gray-200 dark:bg-gray-900 text-white">
                    {/* Sidebar */}
                    <aside className="w-64 bg-gray-800 flex flex-col p-4 border-r border-gray-700">
                        <div className="flex items-center space-x-3 mb-8">
                           <div className="p-2 bg-indigo-600 rounded-lg">ðŸŽ“</div>
                            <span className="font-bold text-xl">Campus Connect</span>
                        </div>
                        <div className="flex-1 space-y-2">
                            <NavButton targetView="home" currentView={view} setView={setView} icon={icons.home}>Home</NavButton>
                            <NavButton targetView="schedule" currentView={view} setView={setView} icon={icons.schedule}>My Schedule</NavButton>
                            <NavButton targetView="dining" currentView={view} setView={setView} icon={icons.dining}>Dining</NavButton>
                            <NavButton targetView="map" currentView={view} setView={setView} icon={icons.map}>Campus Map</NavButton>
                            <NavButton targetView="events" currentView={view} setView={setView} icon={icons.events}>Events</NavButton>
                            <NavButton targetView="faculty" currentView={view} setView={setView} icon={icons.faculty}>Faculty</NavButton>
                            <hr className="border-gray-600 my-2" />
                            <NavButton targetView="complaints" currentView={view} setView={setView} icon={icons.complaints}>Complaints</NavButton>
                            <NavButton targetView="profile" currentView={view} setView={setView} icon={icons.profile}>Profile</NavButton>
                            <NavButton targetView="info" currentView={view} setView={setView} icon={icons.info}>Campus Info</NavButton>
                            <NavButton targetView="admin" currentView={view} setView={setView} icon={icons.admin}>Admin</NavButton>
                        </div>
                        <div className="mt-auto">
                            <button onClick={onLogout} className="w-full flex items-center space-x-3 px-4 py-2.5 text-sm font-medium rounded-lg text-red-300 hover:bg-red-500 hover:text-white transition-colors duration-200">
                                <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" /></svg>
                                <span>Logout</span>
                            </button>
                        </div>
                    </aside>

                    {/* Main Content Area */}
                    <div className="flex-1 flex flex-col">
                        <main className="flex-1 overflow-y-auto p-6 bg-gray-100 dark:bg-gray-900">
                             {view === 'home' && <HomeView setView={setView} />}
                            {view === 'schedule' && <MyScheduleView />}
                            {view === 'dining' && <DiningView />}
                            {view === 'admin' && <AdminView />}
                            {view === 'info' && <InformationView />}
                            {view === 'events' && <EventsView />}
                            {view === 'faculty' && <FacultyView />}
                            {view === 'profile' && <ProfileView />}
                            {view === 'complaints' && <ComplaintView />}
                            {view === 'map' && <CampusMapView />}
                        </main>
                        <footer className="text-center py-2 bg-white dark:bg-gray-800 text-sm text-gray-500 dark:text-gray-400 border-t dark:border-gray-700">
                           <p>Powered by Gemini, FastAPI & React. Ready for the AI-THON!</p>
                       </footer>
                       {/* Floating Chat Bubble & Widget */}
                       <ChatWidget name="Ramesh" selectedBranch={selectedBranch} isOpen={isChatOpen} onClose={() => setIsChatOpen(false)} />
                       {!isChatOpen && (
                         <button 
                            onClick={() => setIsChatOpen(true)}
                            className="fixed bottom-8 right-8 bg-blue-600 text-white rounded-full p-4 shadow-2xl hover:bg-blue-700 focus:outline-none focus:ring-4 focus:ring-blue-400 dark:focus:ring-blue-800 transform hover:scale-110 transition-all duration-300 z-40"
                            aria-label="Open Chat"
                         >
                           <svg xmlns="http://www.w3.org/2000/svg" className="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" /></svg>
                         </button>
                       )}
                    </div>
                </div>
            );
        };
        
        // --- HOME VIEW ---
        const HomeView = ({ setView }) => {
            const FeatureCard = ({ title, description, icon, targetView }) => (
                <div onClick={() => setView(targetView)} className="bg-white dark:bg-gray-800 p-6 rounded-xl shadow-lg hover:shadow-2xl transition-all duration-300 cursor-pointer transform hover:-translate-y-2 border border-transparent hover:border-blue-500">
                    <div className="flex items-center space-x-4">
                        <div className="p-3 bg-blue-100 dark:bg-blue-900 rounded-lg text-blue-600 dark:text-blue-300">
                           {icon}
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-gray-900 dark:text-white">{title}</h3>
                            <p className="text-sm text-gray-500 dark:text-gray-400">{description}</p>
                        </div>
                    </div>
                </div>
            );

            const icons = {
                schedule: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                dining: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l-3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l-3 9m-3-9l-6-2m0-2a2 2 0 012 2v10a2 2 0 01-2 2h-1a2 2 0 01-2-2V8a2 2 0 012-2h1z" /></svg>,
                map: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>,
                info: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>,
                events: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>,
                faculty: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" /></svg>,
                profile: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" /></svg>,
                complaints: <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>,
            };

            return (
                <div className="animate-fade-in-down">
                    <h1 className="text-3xl font-extrabold text-gray-900 dark:text-white mb-2">Welcome Back, Ramesh!</h1>
                    <p className="text-gray-500 dark:text-gray-400 mb-8">Here's your personalized dashboard. What would you like to do today?</p>
                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <FeatureCard title="My Schedule" description="Check your class timetable for the day." icon={icons.schedule} targetView="schedule" />
                        <FeatureCard title="Campus Dining" description="See what's on the menu at the canteen." icon={icons.dining} targetView="dining" />
                        <FeatureCard title="Campus Map" description="Find your way around the campus." icon={icons.map} targetView="map" />
                        <FeatureCard title="Upcoming Events" description="Stay updated on campus events and fests." icon={icons.events} targetView="events" />
                        <FeatureCard title="Faculty Connect" description="Contact details for your professors." icon={icons.faculty} targetView="faculty" />
                        <FeatureCard title="My Profile" description="View your personal details and academic progress." icon={icons.profile} targetView="profile" />
                        <FeatureCard title="Raise a Complaint" description="Submit feedback or complaints to the administration." icon={icons.complaints} targetView="complaints" />
                        <FeatureCard title="Campus Info" description="Get general info like library hours and announcements." icon={icons.info} targetView="info"/>
                    </div>
                </div>
            );
        };
        
        // --- VIEW COMPONENTS (Existing and New) ---

        // NEW: Chat Widget Component
        const ChatWidget = ({ name, selectedBranch, isOpen, onClose }) => {
            const [messages, setMessages] = useState([{ sender: 'bot', text: `Hello ${name}! How can I help you today?` }]);
            const [input, setInput] = useState('');
            const [isLoading, setIsLoading] = useState(false);
            const chatEndRef = useRef(null);
            const [isWidgetVisible, setIsWidgetVisible] = useState(false);
            
            useEffect(() => {
                if (isOpen) {
                    setIsWidgetVisible(true);
                } else {
                    // This timeout allows the exit animation to complete before unmounting
                    const timer = setTimeout(() => setIsWidgetVisible(false), 300);
                    return () => clearTimeout(timer);
                }
            }, [isOpen]);

            useEffect(() => { 
                chatEndRef.current?.scrollIntoView({ behavior: 'smooth' }); 
            }, [messages]);

            const handleSubmit = async (e) => {
                e.preventDefault();
                if (!input.trim() || isLoading) return;
                const userMessage = input;
                setMessages(prev => [...prev, { sender: 'user', text: userMessage }]);
                setIsLoading(true);
                setInput('');

                try {
                    const prompt = `You are Campus Connect AI, a helpful assistant for a university student named ${name}. The student is from the ${selectedBranch} department. Provide a helpful and concise answer to the following question. If the question is about the timetable, ask them to be specific about day and time, as you can look that up. Question: "${userMessage}"`;
                    const botResponse = await callGemini(prompt);
                    setMessages(prev => [...prev, { sender: 'bot', text: botResponse }]);
                } catch (error) {
                    setMessages(prev => [...prev, { sender: 'bot', text: `Sorry, I'm having trouble connecting right now. Please try again later.` }]);
                } finally {
                    setIsLoading(false);
                }
            };

            const widgetClasses = isOpen 
                ? 'chat-widget-enter chat-widget-enter-active' 
                : 'chat-widget-exit chat-widget-exit-active';

            if (!isWidgetVisible) return null;

            return (
                 <div className={`fixed bottom-24 right-8 w-96 h-[600px] bg-white dark:bg-gray-800 rounded-2xl shadow-2xl flex flex-col z-50 border dark:border-gray-700 ${widgetClasses}`}>
                    <header className="p-4 border-b dark:border-gray-700 flex justify-between items-center bg-gray-50 dark:bg-gray-800 rounded-t-2xl">
                        <h3 className="font-bold text-lg">Campus Connect AI</h3>
                        <button onClick={onClose} className="text-gray-500 hover:text-gray-800 dark:hover:text-gray-200">
                           <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                        </button>
                    </header>
                    <div className="flex-1 space-y-4 p-4 pr-2 overflow-y-auto">
                        {messages.map((msg, index) => (
                            <div key={index} className={`flex ${msg.sender === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-xs md:max-w-md lg:max-w-lg px-4 py-3 rounded-2xl shadow ${msg.sender === 'user' ? 'bg-blue-600 text-white' : 'bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100'}`}>{msg.text}</div>
                            </div>
                        ))}
                        {isLoading && (<div className="flex justify-start"><div className="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-100 px-4 py-3 rounded-2xl shadow"><div className="flex items-center space-x-2"><div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse delay-75"></div><div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse delay-150"></div><div className="w-2 h-2 bg-gray-500 rounded-full animate-pulse delay-300"></div></div></div></div>)}
                        <div ref={chatEndRef} />
                    </div>
                    <form onSubmit={handleSubmit} className="p-4 flex items-center space-x-2 border-t border-gray-200 dark:border-gray-700">
                        <input 
                            type="text" 
                            value={input} 
                            onChange={(e) => setInput(e.target.value)} 
                            placeholder="Ask me anything..." 
                            className="flex-1 p-3 rounded-lg bg-gray-200 dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 focus:outline-none transition" 
                            disabled={isLoading} 
                        />
                        <button type="submit" className="bg-blue-600 text-white p-3 rounded-lg hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed transition shadow-lg" disabled={isLoading || !input}>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" className="w-6 h-6"><path d="M3.105 2.289a.75.75 0 00-.826.95l1.414 4.925A1.5 1.5 0 005.135 9.25h6.115a.75.75 0 010 1.5H5.135a1.5 1.5 0 00-1.442 1.086L2.279 16.76a.75.75 0 00.95.826l16-5.333a.75.75 0 000-1.482l-16-5.333z" /></svg>
                        </button>
                    </form>
                </div>
            );
        };
        
        const AdminView = () => {
            const [selectedFile, setSelectedFile] = useState(null);
            const [uploading, setUploading] = useState(false);
            const [uploadSuccess, setUploadSuccess] = useState(false);

            const handleFileChange = (event) => {
                setSelectedFile(event.target.files[0]);
                setUploadSuccess(false);
            };

            const handleUpload = async () => {
                if (!selectedFile) return;
                setUploading(true);
                // Simulate API call
                await new Promise(resolve => setTimeout(resolve, 2000));
                setUploading(false);
                setUploadSuccess(true);
                setSelectedFile(null);
            };

            return (
                <div className="animate-fade-in-down">
                    <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Admin Panel - Data Upload</h2>
                    <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md max-w-2xl mx-auto">
                        <h3 className="text-lg font-semibold mb-2">Upload New Dataset</h3>
                        <p className="text-sm text-gray-500 dark:text-gray-400 mb-4">Upload JSON or CSV files to update campus information like schedules, faculty data, or event calendars.</p>
                        
                        <div className="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center">
                            <input type="file" id="file-upload" className="hidden" onChange={handleFileChange} accept=".json,.csv" />
                            <label htmlFor="file-upload" className="cursor-pointer text-blue-600 dark:text-blue-400 font-semibold">
                                {selectedFile ? `Selected: ${selectedFile.name}` : "Choose a file to upload"}
                            </label>
                            <p className="text-xs text-gray-500 mt-1">JSON or CSV up to 10MB</p>
                        </div>

                        {selectedFile && (
                            <div className="mt-6 text-center">
                                <button
                                    onClick={handleUpload}
                                    className="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300 disabled:bg-blue-400 flex items-center justify-center mx-auto"
                                    disabled={uploading}
                                >
                                    {uploading ? <LoadingSpinner /> : null}
                                    {uploading ? "Uploading..." : "Upload File"}
                                </button>
                            </div>
                        )}

                        {uploadSuccess && (
                            <div className="mt-4 text-center text-green-600 dark:text-green-400 font-semibold">
                                File uploaded successfully! The data is now live.
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const InformationView = () => {
            const [info, setInfo] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                const fetchInfo = async () => {
                    try {
                        const prompt = "Provide a summary of general campus information. Include sections for: Library Hours, Gym Facilities, Health Center contact, and a recent important announcement. Format the response as a simple string, using markdown for headings and lists.";
                        const response = await callGemini(prompt);
                        setInfo(response);
                    } catch (err) {
                        setError("Failed to load campus information. Please try again later.");
                    } finally {
                        setLoading(false);
                    }
                };
                fetchInfo();
            }, []);

            return (
                <div className="animate-fade-in-down">
                     <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Campus Information</h2>
                     <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md">
                        {loading && <p>Loading information...</p>}
                        {error && <p className="text-red-500">{error}</p>}
                        {info && <div className="prose prose-white max-w-none" dangerouslySetInnerHTML={{ __html: info.replace(/\n/g, '<br />') }} />}
                     </div>
                </div>
            );
        };
        
        const MyScheduleView = () => {
             const schedule = {
                "Monday": [{ time: "09:00 - 10:00", subject: "Data Structures", room: "A-201" }, { time: "10:00 - 11:00", subject: "Algorithms", room: "A-201" }],
                "Tuesday": [{ time: "11:00 - 12:00", subject: "Database Systems", room: "B-103" }],
                "Wednesday": [{ time: "09:00 - 10:00", subject: "Data Structures", room: "A-201" }],
                "Thursday": [{ time: "14:00 - 15:00", subject: "Operating Systems", room: "C-305" }],
                "Friday": [{ time: "10:00 - 11:00", subject: "Algorithms Lab", room: "Lab-4" }]
            };
            const days = Object.keys(schedule);
             return (
                 <div className="animate-fade-in-down">
                     <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">My Weekly Schedule</h2>
                     <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                         {days.map(day => (
                             <div key={day} className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                                 <h3 className="font-bold text-lg mb-4 text-blue-600 dark:text-blue-400">{day}</h3>
                                 <div className="space-y-3">
                                     {schedule[day].map((slot, index) => (
                                         <div key={index} className="bg-gray-100 dark:bg-gray-700 p-3 rounded-md">
                                             <p className="font-semibold text-sm text-gray-800 dark:text-gray-200">{slot.subject}</p>
                                             <p className="text-xs text-gray-500 dark:text-gray-400">{slot.time} | Room: {slot.room}</p>
                                         </div>
                                     ))}
                                 </div>
                             </div>
                         ))}
                     </div>
                 </div>
             );
        };
        
        const DiningView = () => {
            const menu = {
                "Breakfast": ["Idli", "Vada", "Sambar", "Chutney"],
                "Lunch": ["Rice", "Dal", "Roti", "Sabzi", "Salad"],
                "Snacks": ["Samosa", "Tea"],
                "Dinner": ["Rice", "Roti", "Dal Fry", "Paneer Curry"]
            };
            return (
                 <div className="animate-fade-in-down">
                     <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Today's Dining Menu</h2>
                     <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md">
                         {Object.entries(menu).map(([meal, items]) => (
                             <div key={meal} className="mb-6">
                                 <h3 className="font-bold text-xl mb-3 text-indigo-600 dark:text-indigo-400">{meal}</h3>
                                 <ul className="list-disc list-inside space-y-1 text-gray-700 dark:text-gray-300">
                                     {items.map(item => <li key={item}>{item}</li>)}
                                 </ul>
                             </div>
                         ))}
                     </div>
                 </div>
            );
        };
        
        const EventsView = () => {
            const events = [
                { name: "Annual Tech Fest 'Innovate 2025'", date: "Oct 15-17, 2025", description: "A 3-day event with coding competitions, workshops, and guest lectures." },
                { name: "Sports Day", date: "Nov 5, 2025", description: "Track and field events, and inter-department matches." },
                { name: "Cultural Night 'Sanskriti'", date: "Dec 10, 2025", description: "An evening of music, dance, and drama performances." }
            ];
            return (
                <div className="animate-fade-in-down">
                    <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Upcoming Campus Events</h2>
                    <div className="space-y-6">
                        {events.map(event => (
                            <div key={event.name} className="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                                <h3 className="font-bold text-lg">{event.name}</h3>
                                <p className="text-sm text-blue-500 dark:text-blue-400 font-semibold my-1">{event.date}</p>
                                <p className="text-gray-600 dark:text-gray-300">{event.description}</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        };
        
        const FacultyView = () => {
            const faculty = [
                { name: "Dr. A. Sharma", department: "Computer Science", email: "asharma@campus.edu" },
                { name: "Prof. B. Verma", department: "Electronics", email: "bverma@campus.edu" },
                { name: "Dr. C. Reddy", department: "Mechanical", email: "creddy@campus.edu" }
            ];
            return (
                <div className="animate-fade-in-down">
                     <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Faculty Directory</h2>
                     <div className="overflow-x-auto bg-white dark:bg-gray-800 rounded-lg shadow-md">
                        <table className="w-full text-sm text-left text-gray-500 dark:text-gray-400">
                            <thead className="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                                <tr>
                                    <th scope="col" className="px-6 py-3">Name</th>
                                    <th scope="col" className="px-6 py-3">Department</th>
                                    <th scope="col" className="px-6 py-3">Email</th>
                                </tr>
                            </thead>
                            <tbody>
                                {faculty.map(f => (
                                    <tr key={f.email} className="bg-white border-b dark:bg-gray-800 dark:border-gray-700">
                                        <th scope="row" className="px-6 py-4 font-medium text-gray-900 whitespace-nowrap dark:text-white">{f.name}</th>
                                        <td className="px-6 py-4">{f.department}</td>
                                        <td className="px-6 py-4"><a href={`mailto:${f.email}`} className="text-blue-600 hover:underline">{f.email}</a></td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };
        
        const ProfileView = () => {
             const student = { name: "Ramesh Kumar", id: "21X01A0501", branch: "CSE", year: 3, cgpa: 8.5, attendance: "85%" };
             return (
                 <div className="animate-fade-in-down">
                     <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">My Profile</h2>
                     <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md max-w-lg mx-auto">
                        <div className="text-center mb-6">
                           <img className="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-blue-500" src="https://placehold.co/100x100/60A5FA/FFFFFF?text=RK" alt="Profile Picture"/>
                           <h3 className="text-xl font-bold">{student.name}</h3>
                           <p className="text-gray-500">{student.id}</p>
                        </div>
                        <div className="grid grid-cols-2 gap-4 text-sm">
                           <div className="font-semibold text-gray-600 dark:text-gray-400">Branch:</div>
                           <div className="text-gray-800 dark:text-gray-200">{student.branch}</div>
                           <div className="font-semibold text-gray-600 dark:text-gray-400">Year:</div>
                           <div className="text-gray-800 dark:text-gray-200">{student.year}</div>
                           <div className="font-semibold text-gray-600 dark:text-gray-400">CGPA:</div>
                           <div className="text-gray-800 dark:text-gray-200">{student.cgpa}</div>
                           <div className="font-semibold text-gray-600 dark:text-gray-400">Attendance:</div>
                           <div className="text-gray-800 dark:text-gray-200">{student.attendance}</div>
                        </div>
                     </div>
                 </div>
             );
        };

        const ComplaintView = () => {
            const [submitted, setSubmitted] = useState(false);
            const handleSubmit = (e) => {
                e.preventDefault();
                setSubmitted(true);
            };

            return (
                <div className="animate-fade-in-down">
                    <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Submit a Complaint</h2>
                    <div className="bg-white dark:bg-gray-800 p-8 rounded-lg shadow-md max-w-2xl mx-auto">
                        {submitted ? (
                             <div className="text-center">
                                <h3 className="text-xl font-bold text-green-600 dark:text-green-400">Thank You!</h3>
                                <p className="mt-2 text-gray-600 dark:text-gray-300">Your complaint has been submitted. You will receive a response within 48 hours.</p>
                                <button onClick={() => setSubmitted(false)} className="mt-6 bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700 transition">
                                    Submit Another
                                </button>
                            </div>
                        ) : (
                            <form onSubmit={handleSubmit} className="space-y-6">
                                <div>
                                    <label htmlFor="category" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Category</label>
                                    <select id="category" className="mt-1 block w-full p-3 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                                        <option>Academics</option>
                                        <option>Hostel</option>
                                        <option>Canteen</option>
                                        <option>Infrastructure</option>
                                        <option>Other</option>
                                    </select>
                                </div>
                                <div>
                                    <label htmlFor="complaint" className="block text-sm font-medium text-gray-700 dark:text-gray-300">Describe your issue</label>
                                    <textarea id="complaint" rows="4" className="mt-1 block w-full p-3 bg-gray-100 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500" required></textarea>
                                </div>
                                <div className="text-right">
                                    <button type="submit" className="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition">
                                        Submit
                                    </button>
                                </div>
                            </form>
                        )}
                    </div>
                </div>
            );
        };
        
        const CampusMapView = () => {
            const [modalContent, setModalContent] = useState(null);
            const pointsOfInterest = [
                { id: "main", name: "Main Building", x: 25, y: 30, details: "Houses the administrative offices, main library, and several CSE department classrooms." },
                { id: "library", name: "Central Library", x: 30, y: 35, details: "Open 24/7 during exams. Wide collection of books and digital resources." },
                { id: "hostel-b", name: "Boys Hostel", x: 75, y: 20, details: "Accommodation for male students. Mess facilities are on the ground floor." },
                { id: "hostel-g", name: "Girls Hostel", x: 70, y: 80, details: "Accommodation for female students. Secure and well-maintained." },
                { id: "canteen", name: "Canteen", x: 50, y: 55, details: "Serves a variety of snacks and meals. Open from 8 AM to 9 PM." },
                { id: "sports", name: "Sports Complex", x: 15, y: 70, details: "Includes a cricket ground, basketball court, and a gym." },
            ];

            return (
                <div className="animate-fade-in-down">
                    <h2 className="text-2xl font-bold mb-6 text-gray-900 dark:text-white">Interactive Campus Map</h2>
                    <div className="relative w-full max-w-4xl mx-auto aspect-[4/3] bg-gray-200 dark:bg-gray-800 rounded-lg overflow-hidden shadow-2xl border-4 border-gray-300 dark:border-gray-700">
                        <img src="https://placehold.co/800x600/22c55e/FFFFFF?text=Campus+Layout" alt="Campus Map Background" className="w-full h-full object-cover" />
                        {pointsOfInterest.map(poi => (
                            <div key={poi.id} className="absolute map-poi" style={{ left: `${poi.x}%`, top: `${poi.y}%` }} onClick={() => setModalContent(poi)}>
                                <div className="w-3 h-3 bg-red-600 rounded-full animate-pulse"></div>
                                <span className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs font-bold bg-black bg-opacity-60 text-white px-2 py-1 rounded-md whitespace-nowrap">{poi.name}</span>
                            </div>
                        ))}
                    </div>
                    <Modal show={!!modalContent} onClose={() => setModalContent(null)} title={modalContent?.name}>
                        {modalContent?.details}
                    </Modal>
                </div>
            );
        };
        
        // --- BACKGROUND ANIMATION ---
        const BackgroundAnimation = () => {
            const canvasRef = useRef(null);

            useEffect(() => {
                const canvas = canvasRef.current;
                const ctx = canvas.getContext('2d');
                let animationFrameId;
                let particles = [];
                const particleCount = 50;

                const resizeCanvas = () => {
                    canvas.width = window.innerWidth;
                    canvas.height = window.innerHeight;
                };
                
                class Particle {
                    constructor(x, y, size, speedX, speedY) {
                        this.x = x; this.y = y; this.size = size; this.speedX = speedX; this.speedY = speedY;
                    }
                    update() {
                        if (this.x > canvas.width || this.x < 0) this.speedX = -this.speedX;
                        if (this.y > canvas.height || this.y < 0) this.speedY = -this.speedY;
                        this.x += this.speedX; this.y += this.speedY;
                    }
                    draw() {
                        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                        ctx.beginPath();
                        ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                        ctx.fill();
                    }
                }

                const initParticles = () => {
                    particles = [];
                    for (let i = 0; i < particleCount; i++) {
                        let size = Math.random() * 2 + 1;
                        let x = Math.random() * canvas.width;
                        let y = Math.random() * canvas.height;
                        let speedX = (Math.random() - 0.5) * 0.5;
                        let speedY = (Math.random() - 0.5) * 0.5;
                        particles.push(new Particle(x, y, size, speedX, speedY));
                    }
                };

                const animate = () => {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);
                    for (let i = 0; i < particles.length; i++) {
                        particles[i].update();
                        particles[i].draw();
                    }
                    connect();
                    animationFrameId = requestAnimationFrame(animate);
                };

                function connect() {
                    let opacityValue = 1;
                    for (let a = 0; a < particles.length; a++) {
                        for (let b = a; b < particles.length; b++) {
                            let distance = ((particles[a].x - particles[b].x) * (particles[a].x - particles[b].x)) + ((particles[a].y - particles[b].y) * (particles[a].y - particles[b].y));
                            if (distance < (canvas.width / 7) * (canvas.height / 7)) {
                                opacityValue = 1 - (distance / 20000);
                                ctx.strokeStyle = `rgba(255, 255, 255, ${opacityValue * 0.2})`;
                                ctx.lineWidth = 1;
                                ctx.beginPath();
                                ctx.moveTo(particles[a].x, particles[a].y);
                                ctx.lineTo(particles[b].x, particles[b].y);
                                ctx.stroke();
                            }
                        }
                    }
                }
                
                resizeCanvas();
                initParticles();
                animate();
                
                window.addEventListener('resize', () => {
                    resizeCanvas();
                    initParticles();
                });

                return () => {
                    cancelAnimationFrame(animationFrameId);
                    window.removeEventListener('resize', resizeCanvas);
                };
            }, []);

            return <canvas ref={canvasRef} id="background-canvas"></canvas>;
        };


        const domContainer = document.getElementById('root');
        const root = ReactDOM.createRoot(domContainer);
        root.render(<App />);
    </script>
</body>
</html>

